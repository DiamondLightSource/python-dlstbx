from __future__ import annotations

from pytest import approx

tests = {
    "i04-eiger-screening": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2021/cm28182-5/20211118/screening/TestInsulin/ins1",
        "src_run_num": (2,),
        "src_prefix": ("ins1",),
        "sample_id": 3635367,
        "results": {
            "a": approx(77.8, abs=1),
            "b": approx(77.8, abs=1),
            "c": approx(77.8, abs=1),
            "alpha": approx(90, abs=0),
            "beta": approx(90, abs=0),
            "gamma": approx(90, abs=0),
            "spacegroup": "I23",
        },
    },
    "i04-eiger-gridscan": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2021/cm28182-2/xraycentring/manual",
        "src_run_num": (29,),
        "src_prefix": ("xrc",),
        "results": {},
    },
    "i04-eiger-high-mult": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2021/cm28182-1/20210226/gw/swmr/TestThaumatin/Se-Thaumatin6",
        "src_run_num": (1,),
        "src_prefix": ("Se-Thaumatin6_400hz_24images",),
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "i04-eiger-native": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2023/mx23694-95/auto/TestProteinaseK/protk5",
        "src_run_num": (2,),
        "src_prefix": ("protk5",),
        "sample_id": 4509789,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "i04-1-eiger-native": {
        "type": "mx",
        "src_dir": "/dls/i04-1/data/2023/cm33904-3/TestLysozyme/Lys-Br16",
        "src_run_num": (1,),
        "src_prefix": ("Lys-Br16",),
        "sample_id": 4684404,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "i23-lysozyme": {
        "type": "mx",
        "src_dir": "/dls/i23/data/2023/cm33851-2/TestLysozyme/lys_1_km70",
        "src_run_num": (1,),
        "src_prefix": ("data",),
        "sample_id": 4493445,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "i04-insulin": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2023/cm33903-3/20230808",
        "src_run_num": (1,),
        "src_prefix": ("ins12",),
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "i04-mad-multi-dcg": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2023/cm33903-4/TestThaumatin/SeThau7",
        "src_run_num": (1,),
        "src_prefix": ("Sethau7_2_pk", "Sethau7_2_if", "Sethau7_2_hrm"),
        "sample_id": 4873871,
        "is_dcg": True,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "i04-sad-multi-dcg": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2023/cm33903-4/TestThaumatin/SeThau2",
        "src_run_num": (
            3,
            4,
            5,
        ),
        "src_prefix": ("SeThau2",),
        "sample_id": 4873856,
        "is_dcg": True,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "i03-native-multi-nondcg": {
        "type": "mx",
        "src_dir": "/dls/i03/data/2021/cm28170-1/Blah/xtal_1",
        "src_run_num": (
            1,
            2,
        ),
        "src_prefix": ("xtal_1",),
        "sample_id": 3221630,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "i03-gridscan": {
        # /dls/i03/data/2022/cm31105-1/xraycentring/TestProteinaseK/protk_16/protk_16_14_master.h5
        # https://ispyb.diamond.ac.uk/dc/visit/cm31105-1/id/7697211
        "type": "mx",
        "src_dir": "/dls/i03/data/2022/cm31105-1/xraycentring/TestProteinaseK/protk_16/",
        "src_run_num": (14,),
        "src_prefix": ("protk_16",),
        "sample_id": 3699723,
    },
    "i03-native": {
        "type": "mx",
        "src_dir": "/dls/i03/data/2023/cm33866-2/TestInsulin/ins_1/",
        "src_run_num": (2,),
        "src_prefix": ("200",),
        "sample_id": 4491570,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "vmxi-rotation": {
        "type": "mx",
        "src_dir": "/dls/mx/data/nt30330/nt30330-89/VMXi-AB2090/well_110/images",
        "src_run_num": (107993,),
        "src_prefix": ("image",),
        "sample_id": 4315478,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "protk-au-insitu": {
        "type": "mx",
        "src_dir": "/dls/i24/data/2017/nr16818-47/Josh/InSitu/CrystalQuickX/ProtK/Au",
        "src_run_num": (1,),
        "src_prefix": (
            "ProtK_InSitu_Au_47_1",
            "ProtK_InSitu_Au_47_2",
            "ProtK_InSitu_Au_47_3",
            "ProtK_InSitu_Au_47_4",
            "ProtK_InSitu_Au_47_5",
            "ProtK_InSitu_Au_47_6",
            "ProtK_InSitu_Au_47_7",
            "ProtK_InSitu_Au_47_8",
            "ProtK_InSitu_Au_47_9",
            "ProtK_InSitu_Au_47_10",
        ),
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
        "delay": 20,
    },
    "smargon-dcg": {
        "type": "mx",
        "src_dir": "/dls/i03/data/2018/cm19644-4/20180912/chigroup/protk",
        "src_run_num": (8, 9, 10),
        "src_prefix": ("protk",),
        "is_dcg": True,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "inverse-beam": {
        "type": "mx",
        "src_dir": "/dls/i23/data/2018/nr19737-17/20180510/lys6",
        "src_run_num": (1,),
        "src_prefix": ("data_2200eV_A_1_", "data_2200eV_B_1_"),
        "is_dcg": True,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "i04-eiger-sad-single": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2023/cm33903-3/20230622/TestLysozyme/lysBr5",
        "src_run_num": (1,),
        "src_prefix": ("lysBr5",),
        "sample_id": 4687158,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "i04-eiger-sad-wedged": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2021/cm28182-2/TestInsulin/insulin2",
        "src_run_num": (4,),
        "src_prefix": ("insulin2_wedged",),
        "sample_id": 3343403,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "screening": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2017/cm16781-1/20170223/group1/Thaum/Th_4",
        "src_run_num": (1,),
        "src_prefix": ("Th_4",),
        "sample_id": 790048,
        "results": {
            "a": approx(57.92, abs=2),
            "b": approx(57.92, abs=2),
            "c": approx(150.51, abs=2),
            "alpha": approx(90, abs=0),
            "beta": approx(90, abs=0),
            "gamma": approx(90, abs=0),
            "spacegroup": "P4",
        },
    },
    "screening-i24": {
        "type": "mx",
        "src_dir": "/dls/i24/data/2017/cm16788-3/screening/hewl/hewl_1",
        "src_run_num": (1,),
        "src_prefix": ("hewl_1",),
        "sample_id": 1018393,
        "results": {
            "a": approx(78.30, abs=2),
            "b": approx(78.39, abs=2),
            "c": approx(36.50, abs=2),
            "alpha": approx(90, abs=0),
            "beta": approx(90, abs=0),
            "gamma": approx(90, abs=0),
            "spacegroup": "P4",
            "required": ("EDNA MXv1", "mosflm"),
        },
    },
    "screening-smargon": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2017/cm16781-1/20170316/Thaum/Th_4",
        "src_run_num": (2,),
        "src_prefix": ("Th_4",),
        "sample_id": 790048,
        "results": {},
    },
    "trp-multi": {
        "type": "mx",
        "src_dir": "/dls/i04/data/2013/nt5966-4/20131007/TRP/P1_X6",
        "src_run_num": (1, 2, 3, 4),
        "src_prefix": ("TRP_M1S6",),
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "i19-1-smallmolecule": {
        "type": "mx",
        "src_dir": "/dls/i19-1/data/2023/cm33867-2/TBB_2_1-col",
        "src_run_num": ("01",),
        "src_prefix": ("TBB2",),
        "sample_id": 4290218,
        "results": {
            "a": approx(100, abs=100),
            "b": approx(100, abs=100),
            "c": approx(100, abs=100),
            "alpha": approx(180, abs=180),
            "beta": approx(180, abs=180),
            "gamma": approx(180, abs=180),
        },
    },
    "relion": {
        "type": "em-spa",
        "frames": list(set(range(21, 50)) - {32, 33, 34, 38, 41}),
        "src_dir": "/dls/m12/data/2022/cm31111-2/raw",
        "src_run_num": (None,),
        "src_prefix": (None,),
        "visit_num": 2,
        "proc_params": {
            "acquisition_software": "SerialEM",
            "import_images": "/dls/m12/data/2022/cm31111-2/raw/Frames/*.tiff",
            "motioncor_gainreference": "/dls/m12/data/2022/cm31111-2/processing/gain.mrc",
            "voltage": "200",
            "Cs": "2.7",
            "ctffind_do_phaseshift": "false",
            "angpix": "0.885",
            "motioncor_binning": "1",
            "motioncor_doseperframe": "1.277",
            "stop_after_ctf_estimation": "false",
        },
        "results": {
            "motion_correction": {
                f"MotionCorr/job002/Movies/Frames/20170629_000{image_number}_frameImage.mrc": {
                    "totalMotion": approx(15, 0.75),
                    # "early_motion": approx(2.5, 0.5),
                    # "late_motion": approx(15, 2),
                    "averageMotionPerFrame": approx(0.5, 1.25),
                }
                for image_number in (set(range(21, 50)) - {32, 33, 34, 38, 41})
            },
            "ctf": {
                f"MotionCorr/job002/Movies/Frames/20170629_000{image_number}_frameImage.mrc": {
                    "astigmatism": approx(0, abs=0.75)
                    if image_number == 42
                    else approx(247, 0.75),
                    "astigmatismAngle": approx(0, abs=360)
                    if image_number == 42
                    else approx(83, 0.75),
                    "estimatedResolution": approx(5, 0.75),
                    "estimatedDefocus": approx(10800, 0.75),
                    "ccValue": approx(0.15, 0.75),
                }
                for image_number in (set(range(21, 50)) - {32, 33, 34, 38, 41})
            },
            "relative_ice_thickness": {
                f"MotionCorr/job002/Movies/Frames/20170629_000{image_number}_frameImage.mrc": {
                    "median": approx(250e3, 0.2),
                    "minimum": approx(250e3, 0.2),
                    "maximum": approx(250e3, 0.2),
                    "q1": approx(250e3, 0.2),
                    "q3": approx(250e3, 0.2),
                }
                for image_number in (set(range(21, 50)) - {32, 33, 34, 38, 41})
            },
            "particle_picker": {
                f"MotionCorr/job002/Movies/Frames/20170629_000{image_number}_frameImage.mrc": {
                    "numberOfParticles": approx(250, 0.75),
                }
                for image_number in (set(range(21, 50)) - {32, 33, 34, 38, 41})
            },
        },
    },
}
