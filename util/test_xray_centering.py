from __future__ import absolute_import, division, print_function

import dlstbx.util.xray_centering

data = [
    (2, 73),
    (1, 0),
    (4, 119),
    (3, 187),
    (5, 2),
    (6, 0),
    (8, 0),
    (7, 0),
    (9, 0),
    (10, 0),
    (11, 0),
    (12, 0),
    (13, 0),
    (14, 0),
    (15, 0),
    (16, 0),
    (17, 0),
    (18, 0),
    (19, 0),
    (20, 0),
    (21, 0),
    (22, 0),
    (23, 144),
    (24, 449),
    (25, 539),
    (26, 418),
    (27, 141),
    (28, 2),
    (29, 0),
    (30, 100),
    (31, 402),
    (32, 592),
    (33, 538),
    (34, 394),
    (35, 221),
    (36, 0),
    (37, 0),
    (38, 0),
    (39, 0),
    (40, 0),
    (41, 0),
    (42, 0),
    (43, 0),
    (44, 0),
    (45, 0),
    (46, 0),
    (47, 0),
    (48, 0),
    (49, 151),
    (50, 352),
    (51, 440),
    (52, 506),
    (53, 515),
    (54, 229),
    (55, 13),
    (56, 0),
    (58, 2),
    (57, 0),
    (59, 27),
    (60, 229),
    (61, 415),
    (62, 481),
    (64, 389),
    (65, 90),
    (63, 387),
    (67, 0),
    (66, 1),
    (68, 0),
    (69, 0),
    (70, 0),
    (71, 0),
    (72, 0),
    (73, 0),
    (74, 0),
    (77, 436),
    (76, 441),
    (78, 385),
    (79, 289),
    (80, 96),
    (75, 107),
    (81, 74),
    (82, 18),
    (83, 0),
    (84, 0),
    (85, 0),
    (86, 0),
    (87, 0),
    (88, 25),
    (89, 26),
    (90, 41),
    (91, 179),
    (92, 376),
    (93, 382),
    (94, 295),
    (95, 28),
    (96, 0),
    (97, 0),
    (98, 0),
    (99, 0),
    (100, 0),
    (101, 14),
    (102, 115),
    (103, 217),
    (104, 159),
    (105, 52),
    (106, 29),
    (107, 44),
    (109, 0),
    (108, 9),
    (110, 0),
    (111, 0),
    (112, 0),
    (113, 0),
    (114, 0),
    (115, 0),
    (116, 0),
    (117, 0),
    (118, 11),
    (119, 57),
    (120, 24),
    (121, 22),
    (122, 16),
    (123, 32),
    (124, 41),
    (125, 11),
    (126, 0),
    (127, 26),
    (128, 48),
    (129, 27),
    (130, 24),
    (131, 16),
    (132, 8),
    (134, 0),
    (133, 2),
    (135, 0),
    (136, 0),
    (137, 0),
    (138, 0),
    (139, 0),
    (140, 0),
    (141, 0),
    (143, 0),
    (142, 0),
    (144, 0),
    (145, 0),
    (146, 0),
    (147, 0),
    (148, 0),
    (149, 0),
    (150, 0),
    (151, 0),
    (152, 10),
    (153, 28),
    (154, 48),
]


def test_xray_centering():
    results, stdout = dlstbx.util.xray_centering.main(data)
    print(stdout)

    assert "There are 592 reflections in image no 32." in stdout
    assert (
        "[ - ,  - , 402, 592, 538, 394,  - ,  - ,  - ,  - ,  - ,  - ,  - ,  - ]"
        in stdout
    )
    assert results == {
        "best_image": 32,
        "best_region": [
            (1, 2),
            (1, 3),
            (1, 4),
            (2, 2),
            (2, 3),
            (2, 4),
            (2, 5),
            (3, 3),
            (3, 4),
            (3, 5),
            (3, 6),
            (4, 4),
            (4, 5),
            (4, 6),
            (4, 7),
            (5, 6),
            (5, 7),
            (5, 8),
            (6, 7),
            (6, 8),
        ],
        "boxSizeXPixels": 1.25,
        "boxSizeYPixels": 1.25,
        "centre_x": 403.0125,
        "centre_x_box": 5.45,
        "centre_y": 245.95,
        "centre_y_box": 3.8,
        "message": "ok",
        "numBoxesX": 14,
        "numBoxesY": 11,
        "reflections_in_best_image": 592,
        "status": "ok",
        "sum_x": 109.0,
        "sum_y": 76.0,
        "topLeft": (396.2, 241.2),
    }
